## 前言
使用中间件，你可以拦截并控制应用里的所有请求和响应。比如你可以基于传入的请求，重写、重定向、修改请求或响应头、甚至直接响应内容。一个比较常见的应用就是鉴权，在打开页面渲染具体的内容前，先判断用户是否登录，如果未登录，则跳转到登录页面。
## 定义
```javascript
//全局中间件(和app目录保持同级)
import { NextResponse } from "next/server"

export function middleware(request){
	return NextResponse.redirect(new URL('/home',request.url))
}


export const config={
	//作用是将 /blog、/blog/xxx、/blog/xxx/xxx 这样的的地址统一重定向到 /home
	matcher:"/blog/:path*"
}
```
## matcher配置项
matcher配置项不仅支持字符串形式，还支持数组形式
```javascript
export const config = {
  matcher: ['/about/:path*', '/dashboard/:path*'],
}
```
## 中间件逻辑
### 如何读取和设置cookies?
对于传入的请求，NextRequest 提供了 get、getAll、set和 delete方法处理 cookies，你也可以用 has检查 cookie 或者 clear删除所有的 cookies。对于返回的响应，NextResponse 同样提供了 get、getAll、set和 delete方法处理 cookies。
```javascript
import { NextResponse } from 'next/server'
 
export function middleware(request) {
  // 假设传入的请求 header 里 "Cookie:nextjs=fast"
  let cookie = request.cookies.get('nextjs')
  console.log(cookie) // => { name: 'nextjs', value: 'fast', Path: '/' }
  const allCookies = request.cookies.getAll()
  console.log(allCookies) // => [{ name: 'nextjs', value: 'fast' }]
 
  request.cookies.has('nextjs') // => true
  request.cookies.delete('nextjs')
  request.cookies.has('nextjs') // => false
 
  // 设置 cookies
  const response = NextResponse.next()
  response.cookies.set('vercel', 'fast')
  response.cookies.set({
    name: 'vercel',
    value: 'fast',
    path: '/',
  })
  cookie = response.cookies.get('vercel')
  console.log(cookie) // => { name: 'vercel', value: 'fast', Path: '/' }
  
  // 响应 header 为 `Set-Cookie:vercel=fast;path=/test`
  return response
}
```
### 如何读取和设置headers?
用法跟路由处理程序一致，使用 NextRequest 和 NextResponse 快捷读取和设置 headers。
```javascript
// middleware.js 
import { NextResponse } from 'next/server'
 
export function middleware(request) {
  //  clone 请求标头
  const requestHeaders = new Headers(request.headers)
  requestHeaders.set('x-hello-from-middleware1', 'hello')
 
  // 你也可以在 NextResponse.rewrite 中设置请求标头
  const response = NextResponse.next({
    request: {
      // 设置新请求标头
      headers: requestHeaders,
    },
  })
 
  // 设置新响应标头 `x-hello-from-middleware2`
  response.headers.set('x-hello-from-middleware2', 'hello')
  return response
}
```
### CORS

### 如何直接响应？



